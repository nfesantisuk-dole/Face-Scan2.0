<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç (Face Scan)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100&display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

   <style>
    /* 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Global CSS ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Sarabun ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
    body, html {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å */
      font-family: 'Sarabun', sans-serif !important;
      
      /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ --- */
      font-size: 16px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ö‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏•‡πá‡∏Å‡πÑ‡∏õ */
      line-height: 1.6; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏•‡∏≤‡∏¢‡∏ï‡∏≤ */
      color: #333; /* ‡∏™‡∏µ‡∏î‡∏≥‡πÄ‡∏ó‡∏≤ ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó (#000) */
      -webkit-font-smoothing: antialiased; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡∏π‡∏ô‡∏ß‡∏•‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
      -moz-osx-font-smoothing: grayscale;
    }

    /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ô Form Elements ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö Body */
    input, select, button, textarea, optgroup, option {
      font-family: 'Sarabun', sans-serif !important;
      font-size: 1rem !important; /* 16px */
      line-height: 1.5 !important;
    }

    /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏•‡∏≤‡∏™‡∏Ç‡∏≠‡∏á Tailwind */
    .font-sans, .font-serif, .font-mono {
      font-family: 'Sarabun', sans-serif !important;
    }

    /* --- Toast Notification --- */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• */
      color: white;
      font-weight: 500;
      font-size: 16px; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ */
      letter-spacing: 0.3px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
      animation: slideIn 0.3s ease-out;
      font-family: 'Sarabun', sans-serif !important;
    }
    .toast.success { background-color: #10b981; }
    .toast.error { background-color: #ef4444; }
    .toast.info { background-color: #3b82f6; }

    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 24px; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
      height: 24px;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* --- Modals --- */
    .config-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(4px); /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Blur ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ Modal ‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
    }
    .config-modal-content {
      background: white;
      padding: 32px;
      border-radius: 16px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
      max-width: 500px;
      width: 90%;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≤‡∏ß‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      color: white;
      font-size: 1.1rem; /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ loading ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
      letter-spacing: 0.5px;
    }
    .loading-overlay .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 24px;
    }

    .confirm-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2500;
      animation: fadeIn 0.2s ease-out;
      backdrop-filter: blur(2px);
    }
    .confirm-modal-content {
      background: white;
      padding: 32px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease-out;
      /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏ô Modal */
      text-align: center; 
      font-size: 1.05rem;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .camera-container {
      width: 100%;
      aspect-ratio: 4/3;
      background: #000;
      border-radius: 12px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° */
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .camera-container video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .camera-container canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
  </style>

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body><div id="loading-overlay" class="loading-overlay">
   <div class="spinner"></div>
   <p id="loading-text" class="text-4xl font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î AI Models...</p>
   <p id="loading-progress" class="text-4xl mt-2">0%</p>
  </div><div id="config-modal" class="config-modal" style="display: none;">
   <div class="config-modal-content">
    <h2 class="text-2xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script</h2>
    <p class="mb-4 text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App</p><input type="text" id="gas-url-input" placeholder="https://script.google.com/macros/s/AKfycbzcROiJNZ-5AQbDYbPs_l2-hoKurM5Cxpt_knt_ufYGp9jOfOGY9qlyMAdiMynmHAD7oA/exec" class="w-full px-4 py-2 border rounded-lg mb-4"> <button id="save-url-btn" class="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL </button>
    <p class="mt-4 text-sm text-gray-500">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: URL ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ "Who has access" ‡πÄ‡∏õ‡πá‡∏ô "Anyone"</p>
   </div>
  </div><div id="confirm-delete-modal" class="confirm-modal" style="display: none;">
   <div class="confirm-modal-content">
    <h2 class="text-2xl font-bold mb-4 text-center" style="color: #ef4444;">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h2>
    <p id="confirm-delete-message" class="mb-6 text-center text-gray-700 text-lg"></p>
    <div class="flex gap-3"><button id="confirm-delete-cancel" class="flex-1 py-3 bg-gray-400 text-white rounded-lg font-semibold hover:bg-gray-500 transition-colors"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button id="confirm-delete-confirm" class="flex-1 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors"> ‡∏•‡∏ö </button>
    </div>
   </div>
  </div>
  <div id="app" class="min-h-full p-6" style="display: none;">
   <div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-8">
     <h1 id="app-title" class="text-4xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç (Face Scan)</h1><button id="change-url-btn" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700"> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL </button>
    </div><div class="flex gap-2 mb-6"><button id="main-tab-attendance" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-2xl">‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</button> <button id="main-tab-register" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-2xl">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button> <button id="main-tab-report" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-2xl">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</button> <button id="main-tab-list" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-2xl">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button> <button id="main-tab-rooms" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-2xl">üè´ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
    </div><div id="attendance-section" class="hidden">
     <div class="p-6 rounded-lg shadow-lg mb-6">
      <h2 class="text-4xl font-semibold mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2><select id="attendance-room-select" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:outline-none text-2xl"> <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ --</option> </select>
     </div>
     <div id="attendance-camera-section" class="hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-semibold mb-4">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
        <div class="camera-container mb-4">
         <video id="attendance-camera-video" autoplay playsinline muted class="w-full h-full object-cover"></video>
         <canvas id="attendance-camera-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none text-xl "></canvas>
        </div>
        <div id="attendance-summary" class="px-6 py-8 rounded-lg font-bold text-center text-2xl shadow-lg mb-4" style="background-color: rgba(16, 185, 129, 0.95); color: white;"><span id="attendance-count">‡∏û‡∏ö 0 ‡∏Ñ‡∏ô</span>
        </div>
        <div class="flex gap-2">
            <button id="start-attendance-camera-btn" class="flex-1 py-8 rounded-lg font-semibold transition-colors text-2xl"> ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á </button> 
            <button id="switch-attendance-camera-btn" class="py-8 px-6 rounded-lg font-semibold transition-colors hidden text-2xl"> üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á </button> 
            <button id="toggle-sound-btn" class="py-8 px-6 rounded-lg font-semibold transition-colors hidden text-2xl bg-blue-500 text-white"> üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î </button>
            
            <button id="stop-attendance-camera-btn" class="flex-1 py-8 rounded-lg font-semibold transition-colors hidden text-2xl"> ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á </button>
        </div>
       </div><div class="p-6 rounded-lg shadow-lg">
        <h2 class="text-4xl font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö(<span id="face-count-detect">0</span>)</h2>
        <div id="detected-list" class="space-y-2 mb-4 max-h-96 overflow-y-auto">
         <p class="text-center py-8 opacity-60 text-2xl">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</p>
        </div><button id="save-attendance-btn" class="w-full py-8 rounded-lg font-semibold transition-colors text-2xl" disabled> <span id="save-attendance-text">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</span>
         <div id="save-attendance-loading" class="loading-spinner mx-auto hidden"></div></button>
       </div>
      </div>
     </div>
    </div><div id="register-section" class="hidden">
     <div class="p-6 rounded-lg shadow-lg mb-6">
      <h2 class="text-2xl font-semibold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h2><div class="flex gap-2 mb-4"><button id="register-tab-upload" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-4xl">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</button> <button id="register-tab-camera" class="flex-1 py-8 px-6 rounded-lg font-semibold transition-colors text-4xl">‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
      </div><div id="register-upload-section">
       <form id="add-face-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label for="person-name" class="block text-2xl font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="person-name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none">
         </div>
         <div><label for="student-room" class="block text-2xl font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <select id="student-room" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none text-2xl"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> </select>
         </div>
        </div>
        <div><label for="face-image" class="block text-4xl font-medium mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label> <input type="file" id="face-image" accept="image/*" required class="w-full px-4 py-2 border rounded-lg">
        </div>
        <div id="preview-container" class="hidden"><img id="image-preview" class="w-full h-48 object-cover rounded-lg">
        </div><button type="submit" id="add-button" class="w-full py-8 rounded-lg font-semibold transition-colors text-4xl"> <span id="add-button-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
         <div id="add-loading" class="loading-spinner mx-auto hidden"></div></button>
       </form>
      </div><div id="register-camera-section" class="hidden space-y-4">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label for="camera-person-name" class="block text-4xl font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="camera-person-name" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none">
        </div>
        <div><label for="camera-student-room" class="block text-4xl font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <select id="camera-student-room" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none text-2xl"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> </select>
        </div>
       </div>
       <div class="camera-container">
        <video id="register-camera-video" autoplay playsinline muted class="w-full h-full object-cover"></video>
        <canvas id="register-camera-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
       </div>
       <div class="flex gap-2"><button id="start-register-camera-btn" class="flex-1 py-3 rounded-lg font-semibold transition-colors text-4xl"> ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á </button> <button id="switch-register-camera-btn" class="py-3 px-4 rounded-lg font-semibold transition-colors hidden text-4xl"> üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á </button> <button id="capture-register-btn" class="flex-1 py-3 rounded-lg font-semibold transition-colors hidden text-4xl"> üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û </button> <button id="save-register-btn" class="flex-1 py-3 rounded-lg font-semibold transition-colors hidden text-4xl"> üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button>
       </div>
       <canvas id="captured-image-canvas" class="w-full rounded-lg hidden" style="aspect-ratio: 4/3; object-fit: cover;"></canvas>
      </div>
     </div>
    </div><div id="report-section" class="hidden">
     <div class="p-6 rounded-lg shadow-lg mb-6">
      <h2 class="text-2xl font-semibold mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
       <div><label for="report-room-select" class="block text-xl font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <select id="report-room-select" class="w-full px-4 py-8 border rounded-lg focus:ring-2 focus:outline-none text-lg"> <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ --</option> </select>
       </div>
       <div><label for="report-start-date" class="block text-xl font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label> <input type="date" id="report-start-date" class="w-full px-4 py-8 border rounded-lg focus:ring-2 focus:outline-none">
       </div>
       <div><label for="report-end-date" class="block text-xl font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label> <input type="date" id="report-end-date" class="w-full px-4 py-8 border rounded-lg focus:ring-2 focus:outline-none">
       </div>
      </div><button id="load-report-btn" class="w-full py-8 rounded-lg font-bold text-lg transition-colors shadow-lg hover:shadow-xl text-2xl"> <span id="load-report-text">üîç ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</span>
       <div id="load-report-loading" class="loading-spinner mx-auto hidden"></div></button>
     </div>
     <div id="report-results" class="hidden">
      <div class="p-6 rounded-lg shadow-lg mb-6">
       <h2 class="text-2xl font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</h2>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="p-4 rounded-lg text-center" style="background-color: rgba(59, 130, 246, 0.1);">
         <p class="text-sm opacity-70">‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</p>
         <p id="total-students" class="text-3xl font-bold mt-2">0</p>
        </div>
        <div class="p-4 rounded-lg text-center" style="background-color: rgba(16, 185, 129, 0.1);">
         <p class="text-sm opacity-70">‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</p>
         <p id="attended-students" class="text-3xl font-bold mt-2" style="color: #10b981;">0</p>
        </div>
        <div class="p-4 rounded-lg text-center" style="background-color: rgba(239, 68, 68, 0.1);">
         <p class="text-sm opacity-70">‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</p>
         <p id="absent-students" class="text-3xl font-bold mt-2" style="color: #ef4444;">0</p>
        </div>
       </div>
      </div>
      <div class="p-6 rounded-lg shadow-lg mb-6">
       <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</h2>
        <div class="flex gap-2"><button id="export-excel-btn" class="px-6 py-3 rounded-lg font-bold transition-colors shadow-md hover:shadow-lg" style="background-color: #10b981; color: white;"> üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel </button> <button id="delete-attendance-btn" class="px-6 py-3 rounded-lg font-bold transition-colors shadow-md hover:shadow-lg" style="background-color: #ef4444; color: white;"> üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• </button>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table id="report-table" class="w-full border-collapse">
         <thead>
          <tr style="background-color: rgba(59, 130, 246, 0.1);">
           <th class="border px-4 py-3 text-left">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
           <th class="border px-4 py-3 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
           <th class="border px-4 py-3 text-left">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
           <th class="border px-4 py-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
           <th class="border px-4 py-3 text-center">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
           <th class="border px-4 py-3 text-center">‡πÄ‡∏ß‡∏•‡∏≤</th>
          </tr>
         </thead>
         <tbody id="report-table-body">
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div><div id="list-section" class="hidden">
     <div class="p-6 rounded-lg shadow-lg mb-6">
      <h2 class="text-4xl font-semibold mb-4">‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h2><select id="list-room-filter" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:outline-none text-4xl"> <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option> </select>
     </div>
     <div class="p-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (<span id="face-count">0</span>)</h2>
      <div id="faces-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
       <p class="col-span-full text-center py-8 opacity-60 text-2xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>
     </div>
    </div><div id="rooms-section" class="hidden">
     <div class="p-6 rounded-lg shadow-lg mb-6">
      <h2 class="text-4xl font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
      <form id="add-room-form" class="space-y-4">
       <div><label for="new-room-name" class="block text-2xl font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label> <input type="text" id="new-room-name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏°.2/1" class="w-full px-8 py-2 border rounded-lg focus:ring-2 focus:outline-none">
       </div><button type="submit" id="add-room-button" class="w-full py-8 rounded-lg font-semibold transition-colors text-2xl"> <span id="add-room-button-text">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
        <div id="add-room-loading" class="loading-spinner mx-auto hidden"></div></button>
      </form>
     </div>
     <div class="p-6 rounded-lg shadow-lg">
      <h2 class="text-4xl font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (<span id="room-count">0</span>)</h2>
      <div id="rooms-list" class="space-y-2">
       <p class="text-center py-8 opacity-60 text-xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#f0f9ff",
      card_color: "#ffffff",
      text_color: "#1e293b",
      primary_button_color: "#3b82f6",
      secondary_button_color: "#ef4444",
      app_title: "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç (Face Scan)",
      register_button_text: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
      attendance_button_text: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°",
      font_family: "Sarabun, sans-serif",
      font_size: 16
    };

    let ROOMS = [];
    let storedFaces = [];
    let registerCameraStream = null;
    let attendanceCameraStream = null;
    let currentMainTab = 'attendance';
    let currentRegisterTab = 'upload';
    let pendingImageData = null;
    let capturedImageData = null;
    let currentRegisterFacingMode = 'user';
    let currentAttendanceFacingMode = 'user';
    let availableCameras = [];
    let GAS_URL = localStorage.getItem('gas_url') || 'https://script.google.com/macros/s/AKfycbzcROiJNZ-5AQbDYbPs_l2-hoKurM5Cxpt_knt_ufYGp9jOfOGY9qlyMAdiMynmHAD7oA/exec';
    let modelsLoaded = false;
    let faceDescriptors = [];
    let attendanceDetectionInterval = null;
    let detectedStudents = new Map();
    let selectedAttendanceRoom = '';
    let selectedListRoomFilter = '';
    let pendingDeleteAction = null;

    // --- Variables for TTS (Text-to-Speech) ---
    let isSoundEnabled = true;
    let spokenStudents = new Map(); // Map to store cooldown timestamp
    const SPEAK_COOLDOWN = 10000;   // 10 seconds cooldown

    // Confirm Delete Modal Functions
    function showConfirmDeleteModal(message, onConfirm) {
      document.getElementById('confirm-delete-message').textContent = message;
      document.getElementById('confirm-delete-modal').style.display = 'flex';
      pendingDeleteAction = onConfirm;
    }

    function hideConfirmDeleteModal() {
      document.getElementById('confirm-delete-modal').style.display = 'none';
      pendingDeleteAction = null;
    }

    document.getElementById('confirm-delete-cancel').addEventListener('click', hideConfirmDeleteModal);

    document.getElementById('confirm-delete-confirm').addEventListener('click', async () => {
      if (pendingDeleteAction) {
        hideConfirmDeleteModal();
        await pendingDeleteAction();
      }
    });

    // Check available cameras
    async function checkAvailableCameras() {
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        availableCameras = devices.filter(device => device.kind === 'videoinput');
        return availableCameras.length > 1;
      } catch (error) {
        console.error('Error checking cameras:', error);
        return false;
      }
    }

    // Load Face-API.js Models
    async function loadModels() {
      const loadingText = document.getElementById('loading-text');
      const loadingProgress = document.getElementById('loading-progress');
      
      try {
        loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î AI Models...';
        loadingProgress.textContent = '0%';

        const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/model';
        
        loadingProgress.textContent = '20%';
        await faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL);
        
        loadingProgress.textContent = '50%';
        await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);
        
        loadingProgress.textContent = '80%';
        await faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL);
        
        loadingProgress.textContent = '100%';
        loadingText.textContent = '‡πÇ‡∏´‡∏•‡∏î AI Models ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        
        modelsLoaded = true;
        
        setTimeout(() => {
          document.getElementById('loading-overlay').style.display = 'none';
          document.getElementById('app').style.display = 'block';
        }, 500);
        
        return true;
      } catch (error) {
        loadingText.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î AI Models ‡πÑ‡∏î‡πâ';
        loadingProgress.textContent = 'Error: ' + error.message;
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î AI Models ‡πÑ‡∏î‡πâ', 'error');
        return false;
      }
    }

    // Extract Face Descriptor from Image
    async function extractFaceDescriptor(imageElement) {
      try {
        const detection = await faceapi
          .detectSingleFace(imageElement)
          .withFaceLandmarks()
          .withFaceDescriptor();
        
        if (!detection) {
          return null;
        }
        
        return detection.descriptor;
      } catch (error) {
        console.error('Error extracting face descriptor:', error);
        return null;
      }
    }

    // Compare Face Descriptors
    function compareFaces(descriptor1, descriptor2, threshold = 0.75) {
      const distance = faceapi.euclideanDistance(descriptor1, descriptor2);
      return {
        match: distance < threshold,
        distance: distance,
        confidence: Math.max(0, (1 - distance) * 100).toFixed(1)
      };
    }

    // --- Helper Function for TTS ---
    function speakWelcome(name) {
        if (!isSoundEnabled) return;

        if ('speechSynthesis' in window) {
            // Cancel previous speech
            window.speechSynthesis.cancel();

            const text = ` ${name} ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß`;
            const utterance = new SpeechSynthesisUtterance(text);
            
            utterance.lang = 'th-TH';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            const voices = window.speechSynthesis.getVoices();
            const thaiVoice = voices.find(v => v.lang.includes('th'));
            if (thaiVoice) {
                utterance.voice = thaiVoice;
            }

            window.speechSynthesis.speak(utterance);
        }
    }

    // Google Apps Script API Functions
    async function fetchRooms() {
      try {
        const response = await fetch(GAS_URL + '?action=getRooms&t=' + Date.now(), {
          method: 'GET',
          mode: 'cors',
          redirect: 'follow'
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          ROOMS = result.data || [];
          updateRoomSelects();
          return true;
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Fetch Rooms Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    async function fetchAttendanceReport(room, startDate, endDate) {
      try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡πà‡∏ô‡∏ä‡∏µ‡∏ï Attendance_<‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á>
        const params = new URLSearchParams({
          action: 'getAttendance',
          room: room,
          t: Date.now()
        });
        
        const response = await fetch(GAS_URL + '?' + params.toString(), {
          method: 'GET',
          mode: 'cors',
          redirect: 'follow'
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          let records = result.data || [];
          
          // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏
          if (startDate && endDate) {
            const start = new Date(startDate);
            start.setHours(0, 0, 0, 0);
            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999);
            
            records = records.filter(record => {
              const recordDate = new Date(record.timestamp);
              return recordDate >= start && recordDate <= end;
            });
          }
          
          return records;
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Fetch Attendance Report Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return [];
      }
    }

    function updateRoomSelects() {
      const selects = [
        document.getElementById('student-room'),
        document.getElementById('camera-student-room'),
        document.getElementById('attendance-room-select'),
        document.getElementById('list-room-filter'),
        document.getElementById('report-room-select')
      ];

      selects.forEach((select, index) => {
        const currentValue = select.value;
        
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå options ‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏ß‡πâ‡∏ô option ‡πÅ‡∏£‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö placeholder)
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° options ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á
        ROOMS.forEach(room => {
          const option = document.createElement('option');
          option.value = room;
          option.textContent = room;
          select.appendChild(option);
        });
        
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        if (ROOMS.includes(currentValue)) {
          select.value = currentValue;
        }
      });
    }

    async function fetchFaces() {
      try {
        const response = await fetch(GAS_URL + '?action=getFaces&t=' + Date.now(), {
          method: 'GET',
          mode: 'cors',
          redirect: 'follow'
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á');
        }
        
        if (result.success) {
          storedFaces = result.data || [];
          
          // Extract face descriptors for all stored faces
          faceDescriptors = [];
          for (const face of storedFaces) {
            if (face.face_descriptor) {
              try {
                faceDescriptors.push({
                  id: face.id,
                  name: face.name,
                  room: face.room,
                  descriptor: new Float32Array(JSON.parse(face.face_descriptor))
                });
              } catch (e) {
                console.error('Error parsing face descriptor:', e);
              }
            }
          }
          
          renderFacesList();
          updateFaceCount();
          showToast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (' + storedFaces.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)', 'success');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Fetch Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        renderFacesList();
        updateFaceCount();
      }
    }

    async function createFace(faceData) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          mode: 'cors',
          redirect: 'follow',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'createFace',
            ...faceData
          })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          await fetchFaces();
          return true;
        }
        throw new Error(result.error || 'Unknown error');
      } catch (error) {
        console.error('Create Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    async function saveAttendance(attendanceData) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          mode: 'cors',
          redirect: 'follow',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'saveAttendance',
            room: selectedAttendanceRoom,
            records: attendanceData
          })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          return true;
        }
        throw new Error(result.error || 'Unknown error');
      } catch (error) {
        console.error('Save Attendance Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

     async function deleteFace(faceId) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          mode: 'cors',
          redirect: 'follow',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'deleteFace',
            id: String(faceId)
          })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          await fetchFaces();
          return true;
        }
        throw new Error(result.error || 'Unknown error');
      } catch (error) {
        console.error('Delete Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    async function createRoom(roomName) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          mode: 'cors',
          redirect: 'follow',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'createRoom',
            room_name: roomName
          })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          await fetchRooms();
          return true;
        }
        throw new Error(result.error || 'Unknown error');
      } catch (error) {
        console.error('Create Room Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    async function deleteRoom(roomName) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          mode: 'cors',
          redirect: 'follow',
          headers: {
            'Content-Type': 'text/plain'
          },
          body: JSON.stringify({
            action: 'deleteRoom',
            room_name: roomName
          })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        const text = await response.text();
        
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          console.error('Response text:', text.substring(0, 200));
          throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        if (result.success) {
          await fetchRooms();
          return true;
        }
        throw new Error(result.error || 'Unknown error');
      } catch (error) {
        console.error('Delete Room Error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    // Modal Functions
    function showConfigModal() {
      document.getElementById('config-modal').style.display = 'flex';
      document.getElementById('gas-url-input').value = GAS_URL;
    }

    function hideConfigModal() {
      document.getElementById('config-modal').style.display = 'none';
    }

    document.getElementById('save-url-btn').addEventListener('click', async () => {
      const url = document.getElementById('gas-url-input').value.trim();
      if (url) {
        GAS_URL = url;
        localStorage.setItem('gas_url', url);
        hideConfigModal();
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        await fetchRooms();
        await fetchFaces();
      } else {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL', 'error');
      }
    });

    document.getElementById('change-url-btn').addEventListener('click', showConfigModal);

    function renderFacesList() {
      const grid = document.getElementById('faces-grid');
      grid.innerHTML = '';

      let filteredFaces = storedFaces;
      if (selectedListRoomFilter) {
        filteredFaces = storedFaces.filter(face => face.room === selectedListRoomFilter);
      }

      if (filteredFaces.length === 0) {
        grid.innerHTML = '<p class="col-span-full text-center py-8 opacity-60">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>';
        return;
      }

      filteredFaces.forEach(face => {
        const card = createFaceCard(face);
        grid.appendChild(card);
      });
    }

    function createFaceCard(face) {
      const card = document.createElement('div');
      card.dataset.faceId = face.id;
      card.className = 'relative rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow';
      card.style.backgroundColor = window.elementSdk?.config?.card_color || defaultConfig.card_color;
      
      card.innerHTML = `
        <img src="${face.image_data}" alt="${face.name}" class="w-full h-32 object-cover">
        <div class="p-3">
          <p class="font-semibold text-center truncate" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">${face.name}</p>
          <p class="text-xs text-center opacity-70" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">${face.room || '-'}</p>
        </div>
        <button class="delete-btn absolute top-2 right-2 w-8 h-8 rounded-full flex items-center justify-center font-bold shadow-lg hover:opacity-80 transition-opacity" style="background-color: ${window.elementSdk?.config?.secondary_button_color || defaultConfig.secondary_button_color}; color: white;">√ó</button>
      `;

      const deleteBtn = card.querySelector('.delete-btn');
      
      deleteBtn.addEventListener('click', async () => {
    
        const faceName = face.name;
        const faceId = face.id;

        deleteBtn.disabled = true;
        deleteBtn.textContent = '...';
        
        const success = await deleteFace(faceId);
        
        if (success) {
            showToast(`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${faceName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
            await fetchFaces();
        } else {
            showToast('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
            deleteBtn.disabled = false;
            deleteBtn.textContent = '√ó';
        }
    });

      return card;
    }

    function updateFaceCount() {
      let count = storedFaces.length;
      if (selectedListRoomFilter) {
        count = storedFaces.filter(face => face.room === selectedListRoomFilter).length;
      }
      document.getElementById('face-count').textContent = count;
    }

    function renderRoomsList() {
    const listContainer = document.getElementById('rooms-list');
    listContainer.innerHTML = '';

    if (ROOMS.length === 0) {
        listContainer.innerHTML = '<p class="text-center py-8 opacity-60">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>';
        document.getElementById('room-count').textContent = '0';
        return;
    }

    const config = window.elementSdk?.config || defaultConfig;
    const textColor = config.text_color || defaultConfig.text_color;
    const cardColor = config.card_color || defaultConfig.card_color;
    const secondaryColor = config.secondary_button_color || defaultConfig.secondary_button_color;
    
    ROOMS.forEach((room, index) => {
        const studentsInRoom = storedFaces.filter(face => face.room === room);
        const studentCount = studentsInRoom.length;
        
        const item = document.createElement('div');
        item.className = 'p-4 rounded-lg shadow-sm flex justify-between items-center';
        item.style.backgroundColor = cardColor;
        item.dataset.roomName = room;
        item.innerHTML = `
            <div class="flex-1">
                <p class="font-semibold" style="color: ${textColor}">${index + 1}. ${room}</p>
                <p class="text-sm opacity-70" style="color: ${textColor}">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${studentCount} ‡∏Ñ‡∏ô</p>
            </div>
            <button class="delete-room-btn px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryColor}; color: white;" data-room="${room}" data-student-count="${studentCount}">
                ‡∏•‡∏ö
            </button>
        `;
        listContainer.appendChild(item);
       
    });

    document.querySelectorAll('.delete-room-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
            const roomName = e.target.dataset.room;
            const studentCount = parseInt(e.target.dataset.studentCount);
            const button = e.target;
            
            button.disabled = true;
            button.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';
            
            const success = await deleteRoom(roomName);
            
            if (success) {
                showToast(`‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ "${roomName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                renderRoomsList();
                await fetchFaces();
            } else {
                showToast('‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
                button.disabled = false;
                button.textContent = '‡∏•‡∏ö';
            }
        });
    });
    
    document.getElementById('room-count').textContent = ROOMS.length;
}

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    let currentReportData = [];

    async function loadReport() {
      const room = document.getElementById('report-room-select').value;
      const startDate = document.getElementById('report-start-date').value;
      const endDate = document.getElementById('report-end-date').value;

      if (!room) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'error');
        return;
      }

      if (!startDate || !endDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', 'error');
        return;
      }

      const loadBtn = document.getElementById('load-report-btn');
      const loadText = document.getElementById('load-report-text');
      const loadLoading = document.getElementById('load-report-loading');
      
      loadBtn.disabled = true;
      loadText.classList.add('hidden');
      loadLoading.classList.remove('hidden');

      const attendanceRecords = await fetchAttendanceReport(room, startDate, endDate);
      
      loadBtn.disabled = false;
      loadText.classList.remove('hidden');
      loadLoading.classList.add('hidden');

      const studentsInRoom = storedFaces.filter(face => face.room === room);
      const totalStudents = studentsInRoom.length;

      const attendedStudentIds = new Set(attendanceRecords.map(record => record.student_id));
      const attendedCount = attendedStudentIds.size;
      const absentCount = totalStudents - attendedCount;

      document.getElementById('total-students').textContent = totalStudents;
      document.getElementById('attended-students').textContent = attendedCount;
      document.getElementById('absent-students').textContent = absentCount;

      currentReportData = [];
      const tableBody = document.getElementById('report-table-body');
      tableBody.innerHTML = '';

      const config = window.elementSdk?.config || defaultConfig;
      const textColor = config.text_color || defaultConfig.text_color;

      let rowIndex = 1;
      studentsInRoom.forEach(student => {
        const studentRecords = attendanceRecords.filter(record => record.student_id === student.id);
        
        if (studentRecords.length > 0) {
          studentRecords.forEach(record => {
            const date = new Date(record.timestamp);
            const row = document.createElement('tr');
            row.style.borderBottom = '1px solid #e5e7eb';
            row.innerHTML = `
              <td class="border px-4 py-3" style="color: ${textColor}">${rowIndex}</td>
              <td class="border px-4 py-3" style="color: ${textColor}">${student.name}</td>
              <td class="border px-4 py-3" style="color: ${textColor}">${student.room}</td>
              <td class="border px-4 py-3 text-center">
                <span class="px-3 py-1 rounded-full text-sm font-semibold" style="background-color: rgba(16, 185, 129, 0.2); color: #10b981;">‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</span>
              </td>
              <td class="border px-4 py-3 text-center" style="color: ${textColor}">${date.toLocaleDateString('th-TH')}</td>
              <td class="border px-4 py-3 text-center" style="color: ${textColor}">${date.toLocaleTimeString('th-TH')}</td>
            `;
            tableBody.appendChild(row);
            
            currentReportData.push({
              no: rowIndex,
              name: student.name,
              room: student.room,
              status: '‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°',
              date: date.toLocaleDateString('th-TH'),
              time: date.toLocaleTimeString('th-TH')
            });
            
            rowIndex++;
          });
        } else {
          const row = document.createElement('tr');
          row.style.borderBottom = '1px solid #e5e7eb';
          row.innerHTML = `
            <td class="border px-4 py-3" style="color: ${textColor}">${rowIndex}</td>
            <td class="border px-4 py-3" style="color: ${textColor}">${student.name}</td>
            <td class="border px-4 py-3" style="color: ${textColor}">${student.room}</td>
            <td class="border px-4 py-3 text-center">
              <span class="px-3 py-1 rounded-full text-sm font-semibold" style="background-color: rgba(239, 68, 68, 0.2); color: #ef4444;">‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°</span>
            </td>
            <td class="border px-4 py-3 text-center" style="color: ${textColor}">-</td>
            <td class="border px-4 py-3 text-center" style="color: ${textColor}">-</td>
          `;
          tableBody.appendChild(row);
          
          currentReportData.push({
            no: rowIndex,
            name: student.name,
            room: student.room,
            status: '‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°',
            date: '-',
            time: '-'
          });
          
          rowIndex++;
        }
      });

      document.getElementById('report-results').classList.remove('hidden');
      showToast('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
    }

    function exportToExcel() {
      if (currentReportData.length === 0) {
        showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'error');
        return;
      }

      const room = document.getElementById('report-room-select').value;
      const startDate = document.getElementById('report-start-date').value;
      const endDate = document.getElementById('report-end-date').value;

      let csv = '\uFEFF';
      csv += `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°\n`;
      csv += `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤: ${room}\n`;
      csv += `‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${startDate} ‡∏ñ‡∏∂‡∏á ${endDate}\n`;
      csv += `‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${document.getElementById('total-students').textContent} ‡∏Ñ‡∏ô\n`;
      csv += `‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°: ${document.getElementById('attended-students').textContent} ‡∏Ñ‡∏ô\n`;
      csv += `‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°: ${document.getElementById('absent-students').textContent} ‡∏Ñ‡∏ô\n\n`;
      
      csv += '‡∏•‡∏≥‡∏î‡∏±‡∏ö,‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•,‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏ß‡∏•‡∏≤\n';
      
      currentReportData.forEach(row => {
        csv += `${row.no},"${row.name}","${row.room}","${row.status}","${row.date}","${row.time}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°_${room}_${startDate}_${endDate}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
    }

    async function deleteAttendanceData() {
        const room = document.getElementById('report-room-select').value;
        const startDate = document.getElementById('report-start-date').value;
        const endDate = document.getElementById('report-end-date').value;
        const deleteBtn = document.getElementById('delete-attendance-btn');

        if (!room || !startDate || !endDate) {
            showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'error');
            return;
        }

        const startDateObj = new Date(startDate);
        const endDateObj = new Date(endDate);
        const startDateThai = startDateObj.toLocaleDateString('th-TH');
        const endDateThai = endDateObj.toLocaleDateString('th-TH');

        deleteBtn.disabled = true;
        deleteBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';

        try {
            const startTimestamp = new Date(startDate + 'T00:00:00').getTime();
            const endTimestamp = new Date(endDate + 'T23:59:59').getTime();

            const response = await fetch(GAS_URL, {
                method: 'POST',
                mode: 'cors',
                redirect: 'follow',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify({
                    action: 'deleteAttendance',
                    room: room,
                    start_timestamp: startTimestamp,
                    end_timestamp: endTimestamp
                })
            });
            
            if (!response.ok) {
                throw new Error('HTTP ' + response.status);
            }
            
            const text = await response.text();
            
            let result;
            try {
                result = JSON.parse(text);
            } catch (e) {
                console.error('Response text:', text.substring(0, 200));
                throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
            
            if (result.success) {
                showToast(`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${result.deleted_count || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) ‡∏´‡πâ‡∏≠‡∏á: ${room}, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${startDateThai} - ${endDateThai}`, 'success');
                await loadReport();
            } else {
                throw new Error(result.error || 'Unknown error');
            }
        } catch (error) {
            console.error('Delete Attendance Error:', error);
            showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        } finally {
            deleteBtn.disabled = false;
            deleteBtn.textContent = 'üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        }
    }

    // Main Tab Switching
    function switchMainTab(tab) {
      currentMainTab = tab;
      const registerSection = document.getElementById('register-section');
      const attendanceSection = document.getElementById('attendance-section');
      const reportSection = document.getElementById('report-section');
      const listSection = document.getElementById('list-section');
      const roomsSection = document.getElementById('rooms-section');
      const tabRegister = document.getElementById('main-tab-register');
      const tabAttendance = document.getElementById('main-tab-attendance');
      const tabReport = document.getElementById('main-tab-report');
      const tabList = document.getElementById('main-tab-list');
      const tabRooms = document.getElementById('main-tab-rooms');

      const config = window.elementSdk?.config || defaultConfig;
      const primaryColor = config.primary_button_color || defaultConfig.primary_button_color;
      const textColor = config.text_color || defaultConfig.text_color;

      registerSection.classList.add('hidden');
      attendanceSection.classList.add('hidden');
      reportSection.classList.add('hidden');
      listSection.classList.add('hidden');
      roomsSection.classList.add('hidden');

      tabRegister.style.backgroundColor = 'transparent';
      tabRegister.style.color = textColor;
      tabRegister.style.border = `2px solid ${textColor}`;
      
      tabAttendance.style.backgroundColor = 'transparent';
      tabAttendance.style.color = textColor;
      tabAttendance.style.border = `2px solid ${textColor}`;
      
      tabReport.style.backgroundColor = 'transparent';
      tabReport.style.color = textColor;
      tabReport.style.border = `2px solid ${textColor}`;
      
      tabList.style.backgroundColor = 'transparent';
      tabList.style.color = textColor;
      tabList.style.border = `2px solid ${textColor}`;
      
      tabRooms.style.backgroundColor = 'transparent';
      tabRooms.style.color = textColor;
      tabRooms.style.border = `2px solid ${textColor}`;

      if (tab === 'register') {
        registerSection.classList.remove('hidden');
        tabRegister.style.backgroundColor = primaryColor;
        tabRegister.style.color = 'white';
        tabRegister.style.border = 'none';
        stopAttendanceCamera();
      } else if (tab === 'attendance') {
        attendanceSection.classList.remove('hidden');
        tabAttendance.style.backgroundColor = primaryColor;
        tabAttendance.style.color = 'white';
        tabAttendance.style.border = 'none';
        stopRegisterCamera();
      } else if (tab === 'report') {
        reportSection.classList.remove('hidden');
        tabReport.style.backgroundColor = primaryColor;
        tabReport.style.color = 'white';
        tabReport.style.border = 'none';
        stopRegisterCamera();
        stopAttendanceCamera();
      } else if (tab === 'list') {
        listSection.classList.remove('hidden');
        tabList.style.backgroundColor = primaryColor;
        tabList.style.color = 'white';
        tabList.style.border = 'none';
        stopRegisterCamera();
        stopAttendanceCamera();
      } else if (tab === 'rooms') {
        roomsSection.classList.remove('hidden');
        tabRooms.style.backgroundColor = primaryColor;
        tabRooms.style.color = 'white';
        tabRooms.style.border = 'none';
        stopRegisterCamera();
        stopAttendanceCamera();
        renderRoomsList();
      }
    }

    // Register Tab Switching
    function switchRegisterTab(tab) {
      currentRegisterTab = tab;
      const uploadSection = document.getElementById('register-upload-section');
      const cameraSection = document.getElementById('register-camera-section');
      const tabUpload = document.getElementById('register-tab-upload');
      const tabCamera = document.getElementById('register-tab-camera');

      const config = window.elementSdk?.config || defaultConfig;
      const primaryColor = config.primary_button_color || defaultConfig.primary_button_color;
      const textColor = config.text_color || defaultConfig.text_color;

      if (tab === 'upload') {
        uploadSection.classList.remove('hidden');
        cameraSection.classList.add('hidden');
        tabUpload.style.backgroundColor = primaryColor;
        tabUpload.style.color = 'white';
        tabCamera.style.backgroundColor = 'transparent';
        tabCamera.style.color = textColor;
        tabCamera.style.border = `2px solid ${textColor}`;
        stopRegisterCamera();
      } else {
        uploadSection.classList.add('hidden');
        cameraSection.classList.remove('hidden');
        tabCamera.style.backgroundColor = primaryColor;
        tabCamera.style.color = 'white';
        tabUpload.style.backgroundColor = 'transparent';
        tabUpload.style.color = textColor;
        tabUpload.style.border = `2px solid ${textColor}`;
      }
    }

    // Register Camera Functions
    async function startRegisterCamera() {
      try {
        const hasMultipleCameras = await checkAvailableCameras();
        
        const constraints = {
          video: {
            facingMode: currentRegisterFacingMode,
            width: { ideal: 1280 },
            height: { ideal: 960 }
          },
          audio: false
        };
        
        registerCameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.getElementById('register-camera-video');
        video.srcObject = registerCameraStream;
        
        await video.play();
        
        document.getElementById('start-register-camera-btn').classList.add('hidden');
        document.getElementById('capture-register-btn').classList.remove('hidden');
        
        if (hasMultipleCameras) {
          document.getElementById('switch-register-camera-btn').classList.remove('hidden');
        }
        
        video.addEventListener('loadedmetadata', () => {
          const canvas = document.getElementById('register-camera-canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
        });
        
        showToast('‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      } catch (error) {
        console.error('Camera error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + error.message, 'error');
      }
    }

    async function switchRegisterCamera() {
      currentRegisterFacingMode = currentRegisterFacingMode === 'user' ? 'environment' : 'user';
      stopRegisterCamera();
      await startRegisterCamera();
    }

    function stopRegisterCamera() {
      if (registerCameraStream) {
        registerCameraStream.getTracks().forEach(track => track.stop());
        registerCameraStream = null;
        const video = document.getElementById('register-camera-video');
        video.srcObject = null;
        
        document.getElementById('start-register-camera-btn').classList.remove('hidden');
        document.getElementById('switch-register-camera-btn').classList.add('hidden');
        document.getElementById('capture-register-btn').classList.add('hidden');
        document.getElementById('save-register-btn').classList.add('hidden');
        document.getElementById('captured-image-canvas').classList.add('hidden');
        
        const canvas = document.getElementById('register-camera-canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        capturedImageData = null;
      }
    }

    function captureRegisterImage() {
      const video = document.getElementById('register-camera-video');
      const canvas = document.getElementById('captured-image-canvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      
      capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
      canvas.classList.remove('hidden');
      document.getElementById('save-register-btn').classList.remove('hidden');
      
      showToast('‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
    }

    async function saveRegisterImage() {
      const name = document.getElementById('camera-person-name').value.trim();
      const room = document.getElementById('camera-student-room').value;

      if (!name) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', 'error');
        return;
      }

      if (!room) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'error');
        return;
      }

      if (!capturedImageData) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      const saveBtn = document.getElementById('save-register-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      try {
        const img = new Image();
        img.onload = async () => {
          const descriptor = await extractFaceDescriptor(img);
          
          if (!descriptor) {
            showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà', 'error');
            saveBtn.disabled = false;
            saveBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            return;
          }

          const newFace = {
            id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9),
            name: name,
            room: room,
            image_data: capturedImageData,
            face_descriptor: JSON.stringify(Array.from(descriptor)),
            created_at: new Date().toISOString()
          };

          const success = await createFace(newFace);
          
          saveBtn.disabled = false;
          saveBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

          if (success) {
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            document.getElementById('camera-person-name').value = '';
            document.getElementById('camera-student-room').value = '';
            document.getElementById('captured-image-canvas').classList.add('hidden');
            document.getElementById('save-register-btn').classList.add('hidden');
            capturedImageData = null;
          }
        };
        img.onerror = () => {
          saveBtn.disabled = false;
          saveBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
          showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ', 'error');
        };
        img.src = capturedImageData;
      } catch (error) {
        saveBtn.disabled = false;
        saveBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      }
    }

    // Attendance Camera Functions
    async function startAttendanceCamera() {
      if (!selectedAttendanceRoom) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      try {
        const hasMultipleCameras = await checkAvailableCameras();
        
        const constraints = {
          video: {
            facingMode: currentAttendanceFacingMode,
            width: { ideal: 1280 },
            height: { ideal: 960 }
          },
          audio: false
        };
        
        attendanceCameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.getElementById('attendance-camera-video');
        video.srcObject = attendanceCameraStream;
        
        await video.play();
        
        document.getElementById('start-attendance-camera-btn').classList.add('hidden');
        document.getElementById('stop-attendance-camera-btn').classList.remove('hidden');
        document.getElementById('toggle-sound-btn').classList.remove('hidden'); // Show Sound Button
        
        // Load voices just in case
        window.speechSynthesis.getVoices();

        if (hasMultipleCameras) {
          document.getElementById('switch-attendance-camera-btn').classList.remove('hidden');
        }
        
        video.addEventListener('loadedmetadata', () => {
          const canvas = document.getElementById('attendance-camera-canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          
          startAttendanceDetection();
        });
        
        showToast('‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤', 'success');
      } catch (error) {
        console.error('Camera error:', error);
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + error.message, 'error');
      }
    }

    async function switchAttendanceCamera() {
      currentAttendanceFacingMode = currentAttendanceFacingMode === 'user' ? 'environment' : 'user';
      stopAttendanceCamera();
      await startAttendanceCamera();
    }

    function stopAttendanceCamera() {
      if (attendanceCameraStream) {
        attendanceCameraStream.getTracks().forEach(track => track.stop());
        attendanceCameraStream = null;
        const video = document.getElementById('attendance-camera-video');
        video.srcObject = null;
        
        document.getElementById('start-attendance-camera-btn').classList.remove('hidden');
        document.getElementById('switch-attendance-camera-btn').classList.add('hidden');
        document.getElementById('stop-attendance-camera-btn').classList.add('hidden');
        document.getElementById('toggle-sound-btn').classList.add('hidden'); // Hide Sound Button
        
        stopAttendanceDetection();
        
        const canvas = document.getElementById('attendance-camera-canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    function startAttendanceDetection() {
      if (attendanceDetectionInterval) {
        clearInterval(attendanceDetectionInterval);
      }
      
      attendanceDetectionInterval = setInterval(async () => {
        await detectAttendanceFaces();
      }, 500);
    }

    function stopAttendanceDetection() {
      if (attendanceDetectionInterval) {
        clearInterval(attendanceDetectionInterval);
        attendanceDetectionInterval = null;
      }
    }

    // --- UPDATED: detectAttendanceFaces with TTS Logic ---
    async function detectAttendanceFaces() {
      const video = document.getElementById('attendance-camera-video');
      const canvas = document.getElementById('attendance-camera-canvas');
      const ctx = canvas.getContext('2d');

      if (!video.videoWidth || !modelsLoaded || faceDescriptors.length === 0) {
        return;
      }

      const roomFaceDescriptors = faceDescriptors.filter(face => face.room === selectedAttendanceRoom);

      if (roomFaceDescriptors.length === 0) {
        return;
      }

      try {
        const detections = await faceapi
          .detectAllFaces(video)
          .withFaceLandmarks()
          .withFaceDescriptors();

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (detections.length > 0) {
          detections.forEach(detection => {
            const box = detection.detection.box;
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 3;
            ctx.strokeRect(box.x, box.y, box.width, box.height);

            let bestMatch = null;
            let bestConfidence = 0;

            for (const storedFace of roomFaceDescriptors) {
              const comparison = compareFaces(detection.descriptor, storedFace.descriptor);
              if (comparison.match && parseFloat(comparison.confidence) > bestConfidence) {
                bestMatch = storedFace;
                bestConfidence = parseFloat(comparison.confidence);
              }
            }

            if (bestMatch) {
              // Normalize confidence
              const normalizedConf = getNormalizedConfidence(bestConfidence);
              const label = `${bestMatch.name} (${normalizedConf.toFixed(1)}%)`;
              
              // Filter Threshold (e.g. 50%)
              if (normalizedConf >= 50) {
                  
                  // 1. Add to List
                  if (!detectedStudents.has(bestMatch.id)) {
                    detectedStudents.set(bestMatch.id, {
                      id: bestMatch.id,
                      name: bestMatch.name,
                      room: bestMatch.room,
                      timestamp: new Date().toISOString(),
                      confidence: bestConfidence
                    });
                    updateDetectedList();
                  }

                  // 2. Text-to-Speech with Cooldown
                  const now = Date.now();
                  const lastSpoken = spokenStudents.get(bestMatch.id) || 0;

                  if (now - lastSpoken > SPEAK_COOLDOWN) {
                      speakWelcome(bestMatch.name); 
                      spokenStudents.set(bestMatch.id, now); 
                  }
              }
              
              ctx.fillStyle = 'rgba(16, 185, 129, 0.95)';
              ctx.font = 'bold 24px Sarabun, sans-serif';
              const textWidth = ctx.measureText(label).width;
              ctx.fillRect(box.x, box.y - 30, textWidth + 16, 28);
              ctx.fillStyle = 'white';
              ctx.fillText(label, box.x + 8, box.y - 10);
            } else {
              const label = '‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å';
              
              ctx.fillStyle = 'rgba(239, 68, 68, 0.95)';
              ctx.font = 'bold 18px Sarabun, sans-serif';
              const textWidth = ctx.measureText(label).width;
              ctx.fillRect(box.x, box.y - 30, textWidth + 16, 28);
              ctx.fillStyle = 'white';
              ctx.fillText(label, box.x + 8, box.y - 10);
            }
          });

          document.getElementById('attendance-count').textContent = `‡∏û‡∏ö ${detections.length} ‡∏Ñ‡∏ô`;
        } else {
          document.getElementById('attendance-count').textContent = '‡∏û‡∏ö 0 ‡∏Ñ‡∏ô';
        }
      } catch (error) {
        console.error('Detection error:', error);
      }
    }

    function getNormalizedConfidence(confidence) {
        if (confidence === undefined || confidence === null) {
            return 0;
        }
        let normalizedConfidence = confidence;
        if (normalizedConfidence >= 1 && normalizedConfidence <= 100) {
            return normalizedConfidence;
        } else if (normalizedConfidence > 0 && normalizedConfidence < 1) {
            return normalizedConfidence * 100;
        } else if (normalizedConfidence > 100) {
            return normalizedConfidence / 100;
        } 
        return 0; 
    }

    function updateDetectedList() {
        const listContainer = document.getElementById('detected-list');
        listContainer.innerHTML = '';

        if (detectedStudents.size === 0) {
            listContainer.innerHTML = '<p class="text-center py-8 opacity-60">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</p>';
            document.getElementById('save-attendance-btn').disabled = true;
            return;
        }

        const config = window.elementSdk?.config || defaultConfig;
        const textColor = config.text_color || defaultConfig.text_color;

        detectedStudents.forEach((student, id) => {
            let valueToDisplay = 0;
            let displayConfidence = 'N/A';
            
            if (student.confidence !== undefined) {
                const normalizedConfidenceForFilter = getNormalizedConfidence(student.confidence); 
                if (normalizedConfidenceForFilter < 50) { 
                    return; 
                }
                valueToDisplay = normalizedConfidenceForFilter;
                displayConfidence = valueToDisplay.toFixed(2) + '%';
            } else {
                 return;
            }

            const item = document.createElement('div');
            item.className = 'p-3 rounded-lg shadow-sm';
            item.style.backgroundColor = config.card_color || defaultConfig.card_color;
            item.innerHTML = `
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <p class="font-semibold" style="color: ${textColor}">${student.name}</p>
                  <p class="text-xs opacity-70" style="color: ${textColor}">${student.room}</p>
                  <p class="text-xs" style="color: ${textColor}; margin-top: 4px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô: ${displayConfidence}</p>
                  <p class="text-xs opacity-50" style="color: ${textColor}">${new Date(student.timestamp).toLocaleTimeString('th-TH')}</p>
                </div>
                <button class="remove-detected-btn text-xl font-bold opacity-50 hover:opacity-100" style="color: ${config.secondary_button_color || defaultConfig.secondary_button_color}" data-id="${id}">√ó</button>
              </div>
            `;
            listContainer.appendChild(item);
        });
        document.getElementById('face-count-detect').textContent = listContainer.children.length;

        document.querySelectorAll('.remove-detected-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = e.target.dataset.id;
                detectedStudents.delete(id);
                updateDetectedList();
            });
        });
        
        document.getElementById('save-attendance-btn').disabled = (listContainer.children.length === 0);
    }

    async function saveAttendanceRecord() {
      if (detectedStudents.size === 0) {
        showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö', 'error');
        return;
      }

      const saveBtn = document.getElementById('save-attendance-btn');
      const saveBtnText = document.getElementById('save-attendance-text');
      const saveLoading = document.getElementById('save-attendance-loading');
      
      saveBtn.disabled = true;
      saveBtnText.classList.add('hidden');
      saveLoading.classList.remove('hidden');

      const records = Array.from(detectedStudents.values());
      const success = await saveAttendance(records);

      saveBtn.disabled = false;
      saveBtnText.classList.remove('hidden');
      saveLoading.classList.add('hidden');

      if (success) {
        showToast(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${records.length} ‡∏Ñ‡∏ô)`, 'success');
        detectedStudents.clear();
        updateDetectedList();
      }
    }

    // Event Listeners
    document.getElementById('main-tab-register').addEventListener('click', () => switchMainTab('register'));
    document.getElementById('main-tab-attendance').addEventListener('click', () => switchMainTab('attendance'));
    document.getElementById('main-tab-report').addEventListener('click', () => switchMainTab('report'));
    document.getElementById('main-tab-list').addEventListener('click', () => switchMainTab('list'));
    document.getElementById('main-tab-rooms').addEventListener('click', () => switchMainTab('rooms'));

    document.getElementById('load-report-btn').addEventListener('click', loadReport);
    document.getElementById('export-excel-btn').addEventListener('click', exportToExcel);
    document.getElementById('delete-attendance-btn').addEventListener('click', deleteAttendanceData);

    document.getElementById('register-tab-upload').addEventListener('click', () => switchRegisterTab('upload'));
    document.getElementById('register-tab-camera').addEventListener('click', () => switchRegisterTab('camera'));

    document.getElementById('start-register-camera-btn').addEventListener('click', startRegisterCamera);
    document.getElementById('switch-register-camera-btn').addEventListener('click', switchRegisterCamera);
    document.getElementById('capture-register-btn').addEventListener('click', captureRegisterImage);
    document.getElementById('save-register-btn').addEventListener('click', saveRegisterImage);

    document.getElementById('start-attendance-camera-btn').addEventListener('click', startAttendanceCamera);
    document.getElementById('switch-attendance-camera-btn').addEventListener('click', switchAttendanceCamera);
    document.getElementById('stop-attendance-camera-btn').addEventListener('click', stopAttendanceCamera);
    document.getElementById('save-attendance-btn').addEventListener('click', saveAttendanceRecord);

    // --- Sound Button Listener ---
    const soundBtn = document.getElementById('toggle-sound-btn');
    soundBtn.addEventListener('click', () => {
        isSoundEnabled = !isSoundEnabled;
        if (isSoundEnabled) {
            soundBtn.textContent = 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î';
            soundBtn.classList.remove('bg-gray-500');
            soundBtn.classList.add('bg-blue-500');
        } else {
            soundBtn.textContent = 'üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡∏õ‡∏¥‡∏î';
            soundBtn.classList.remove('bg-blue-500');
            soundBtn.classList.add('bg-gray-500');
            window.speechSynthesis.cancel(); 
        }
    });

    document.getElementById('attendance-room-select').addEventListener('change', (e) => {
      selectedAttendanceRoom = e.target.value;
      if (selectedAttendanceRoom) {
        document.getElementById('attendance-camera-section').classList.remove('hidden');
        detectedStudents.clear();
        updateDetectedList();
        stopAttendanceCamera();
      } else {
        document.getElementById('attendance-camera-section').classList.add('hidden');
        stopAttendanceCamera();
      }
    });

    document.getElementById('list-room-filter').addEventListener('change', (e) => {
      selectedListRoomFilter = e.target.value;
      renderFacesList();
      updateFaceCount();
    });

    document.getElementById('add-room-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const roomName = document.getElementById('new-room-name').value.trim();

      if (!roomName) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'error');
        return;
      }

      if (ROOMS.includes(roomName)) {
        showToast('‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'error');
        return;
      }

      const addRoomButton = document.getElementById('add-room-button');
      const addRoomButtonText = document.getElementById('add-room-button-text');
      const addRoomLoading = document.getElementById('add-room-loading');
      
      addRoomButton.disabled = true;
      addRoomButtonText.classList.add('hidden');
      addRoomLoading.classList.remove('hidden');

      const success = await createRoom(roomName);
      
      addRoomButton.disabled = false;
      addRoomButtonText.classList.remove('hidden');
      addRoomLoading.classList.add('hidden');

      if (success) {
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        document.getElementById('add-room-form').reset();
        renderRoomsList();
      }
    });

    document.getElementById('face-image').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          pendingImageData = event.target.result;
          document.getElementById('image-preview').src = pendingImageData;
          document.getElementById('preview-container').classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById('add-face-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('person-name').value.trim();
      const room = document.getElementById('student-room').value;

      if (!name) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', 'error');
        return;
      }

      if (!room) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤', 'error');
        return;
      }

      if (!pendingImageData) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
        return;
      }

      const addButton = document.getElementById('add-button');
      const addButtonText = document.getElementById('add-button-text');
      const addLoading = document.getElementById('add-loading');
      
      addButton.disabled = true;
      addButtonText.classList.add('hidden');
      addLoading.classList.remove('hidden');

      try {
        const img = new Image();
        img.onload = async () => {
          const descriptor = await extractFaceDescriptor(img);
          
          if (!descriptor) {
            showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô', 'error');
            addButton.disabled = false;
            addButtonText.classList.remove('hidden');
            addLoading.classList.add('hidden');
            return;
          }

          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          const maxWidth = 400;
          const maxHeight = 400;
          let width = img.width;
          let height = img.height;
          
          if (width > height) {
            if (width > maxWidth) {
              height *= maxWidth / width;
              width = maxWidth;
            }
          } else {
            if (height > maxHeight) {
              width *= maxHeight / height;
              height = maxHeight;
            }
          }
          
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          
          const compressedImageData = canvas.toDataURL('image/jpeg', 0.7);
          
          const newFace = {
            id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9),
            name: name,
            room: room,
            image_data: compressedImageData,
            face_descriptor: JSON.stringify(Array.from(descriptor)),
            created_at: new Date().toISOString()
          };

          const success = await createFace(newFace);
          
          addButton.disabled = false;
          addButtonText.classList.remove('hidden');
          addLoading.classList.add('hidden');

          if (success) {
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            document.getElementById('add-face-form').reset();
            document.getElementById('preview-container').classList.add('hidden');
            pendingImageData = null;
          }
        };
        img.onerror = () => {
          addButton.disabled = false;
          addButtonText.classList.remove('hidden');
          addLoading.classList.add('hidden');
          showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ', 'error');
        };
        img.src = pendingImageData;
      } catch (error) {
        addButton.disabled = false;
        addButtonText.classList.remove('hidden');
        addLoading.classList.add('hidden');
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      }
    });

    async function onConfigChange(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Sarabun, sans-serif';

      document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseSize}px`;

      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('app-title').style.color = config.text_color || defaultConfig.text_color;
      document.getElementById('app-title').style.fontSize = `${baseSize * 2}px`;

      document.getElementById('add-button-text').textContent = config.register_button_text || defaultConfig.register_button_text;
      document.getElementById('save-attendance-text').textContent = config.attendance_button_text || defaultConfig.attendance_button_text;

      const cards = document.querySelectorAll('.p-6.rounded-lg.shadow-lg');
      cards.forEach(card => {
        card.style.backgroundColor = config.card_color || defaultConfig.card_color;
      });

      const headings = document.querySelectorAll('h2');
      headings.forEach(h => {
        h.style.color = config.text_color || defaultConfig.text_color;
        h.style.fontSize = `${baseSize * 1.5}px`;
      });

      const labels = document.querySelectorAll('label');
      labels.forEach(label => {
        label.style.color = config.text_color || defaultConfig.text_color;
        label.style.fontSize = `${baseSize * 0.875}px`;
      });

      const primaryButtons = [
        document.getElementById('add-button'),
        document.getElementById('start-register-camera-btn'),
        document.getElementById('switch-register-camera-btn'),
        document.getElementById('capture-register-btn'),
        document.getElementById('save-register-btn'),
        document.getElementById('start-attendance-camera-btn'),
        document.getElementById('switch-attendance-camera-btn'),
        document.getElementById('save-attendance-btn'),
        document.getElementById('add-room-button'),
        document.getElementById('load-report-btn')
      ];

      primaryButtons.forEach(btn => {
        if (btn) {
          btn.style.backgroundColor = config.primary_button_color || defaultConfig.primary_button_color;
          btn.style.color = 'white';
        }
      });

      const stopBtn = document.getElementById('stop-attendance-camera-btn');
      if (stopBtn) {
        stopBtn.style.backgroundColor = config.secondary_button_color || defaultConfig.secondary_button_color;
        stopBtn.style.color = 'white';
      }

      switchMainTab(currentMainTab);
      switchRegisterTab(currentRegisterTab);
      renderFacesList();
      updateDetectedList();
    }

    async function init() {
      // Initialize Element SDK first
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.card_color || defaultConfig.card_color,
                set: (value) => {
                  config.card_color = value;
                  window.elementSdk.setConfig({ card_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_button_color || defaultConfig.primary_button_color,
                set: (value) => {
                  config.primary_button_color = value;
                  window.elementSdk.setConfig({ primary_button_color: value });
                }
              },
              {
                get: () => config.secondary_button_color || defaultConfig.secondary_button_color,
                set: (value) => {
                  config.secondary_button_color = value;
                  window.elementSdk.setConfig({ secondary_button_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["register_button_text", config.register_button_text || defaultConfig.register_button_text],
            ["attendance_button_text", config.attendance_button_text || defaultConfig.attendance_button_text]
          ])
        });

        await onConfigChange(window.elementSdk.config);
      } else {
        await onConfigChange(defaultConfig);
      }

      // Load models after SDK initialization
      const loaded = await loadModels();
      if (!loaded) {
        return;
      }

      // Load data after everything is ready
      if (!GAS_URL) {
        showConfigModal();
      } else {
        await fetchRooms();
        await fetchFaces();
      }
    }

    if (typeof faceapi !== 'undefined') {
      init();
    } else {
      window.addEventListener('load', init);
    }
  </script>
   <footer class="fixed bottom-0 left-0 right-0 bg-gray-800 text-white text-center p-3 text-xs z-50 shadow-inner">
    ¬© 2025 ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç (Face Scan) <br>‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤: <a href="https://sites.google.com/cmi.nfe.go.th/nfesantisuk" target="_blank" class="underline hover:text-blue-300">‡∏ô‡∏≤‡∏¢‡∏¢‡∏∏‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏Ç‡∏±‡∏ô‡πÅ‡∏Ç‡πà‡∏á‡∏ö‡∏∏‡∏ç ‡∏Ñ‡∏£‡∏π ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç</a></br>
  </footer>
 </body>
</html>
